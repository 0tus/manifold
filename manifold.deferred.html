<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>manifold.deferred documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Manifold 0.1.1 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>manifold</span></div></div></li><li class="depth-2 branch"><a href="manifold.bus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bus</span></div></a></li><li class="depth-2 branch current"><a href="manifold.deferred.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deferred</span></div></a></li><li class="depth-2 branch"><a href="manifold.executor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>executor</span></div></a></li><li class="depth-2 branch"><a href="manifold.stream.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stream</span></div></a></li><li class="depth-2"><a href="manifold.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="manifold.deferred.html#var--.3Edeferred"><div class="inner"><span>-&gt;deferred</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-add-listener.21"><div class="inner"><span>add-listener!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-cancel-listener.21"><div class="inner"><span>cancel-listener!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-catch"><div class="inner"><span>catch</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-catch.27"><div class="inner"><span>catch&apos;</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-chain"><div class="inner"><span>chain</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-chain.27"><div class="inner"><span>chain&apos;</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-claim.21"><div class="inner"><span>claim!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-Deferrable"><div class="inner"><span>Deferrable</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-deferrable.3F"><div class="inner"><span>deferrable?</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-deferred"><div class="inner"><span>deferred</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-deferred.3F"><div class="inner"><span>deferred?</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-error.21"><div class="inner"><span>error!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-error-deferred"><div class="inner"><span>error-deferred</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-finally"><div class="inner"><span>finally</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-finally.27"><div class="inner"><span>finally&apos;</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-future"><div class="inner"><span>future</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-future-with"><div class="inner"><span>future-with</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-let-flow"><div class="inner"><span>let-flow</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-let-flow.27"><div class="inner"><span>let-flow&apos;</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-listener"><div class="inner"><span>listener</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-loop"><div class="inner"><span>loop</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-on-realized"><div class="inner"><span>on-realized</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-onto"><div class="inner"><span>onto</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-realized.3F"><div class="inner"><span>realized?</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-recur"><div class="inner"><span>recur</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-success.21"><div class="inner"><span>success!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-success-deferred"><div class="inner"><span>success-deferred</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-timeout.21"><div class="inner"><span>timeout!</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-unwrap"><div class="inner"><span>unwrap</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-unwrap.27"><div class="inner"><span>unwrap&apos;</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-zip"><div class="inner"><span>zip</span></div></a></li><li class="depth-1"><a href="manifold.deferred.html#var-zip.27"><div class="inner"><span>zip&apos;</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">manifold.deferred</h2><div class="doc"><div class="markdown"><p>Methods for creating, transforming, and interacting with asynchronous values.</p></div></div><div class="public anchor" id="var--.3Edeferred"><h3>-&gt;deferred</h3><div class="usage"><code>(-&gt;deferred x)</code><code>(-&gt;deferred x default-val)</code></div><div class="doc"><div class="markdown"><p>Transforms <code>x</code> into a deferred if possible, or returns <code>default-val</code>. If no default value is given, an <code>IllegalArgumentException</code> is thrown.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L121">view source</a></div></div><div class="public anchor" id="var-add-listener.21"><h3>add-listener!</h3><div class="usage"><code>(add-listener! deferred listener)</code></div><div class="doc"><div class="markdown"><p>Registers a listener which can be cancelled via <code>cancel-listener!</code>. Unless this is useful, prefer <code>on-realized</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L259">view source</a></div></div><div class="public anchor" id="var-cancel-listener.21"><h3>cancel-listener!</h3><div class="usage"><code>(cancel-listener! deferred listener)</code></div><div class="doc"><div class="markdown"><p>Cancels a listener which has been registered via <code>add-listener!</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L264">view source</a></div></div><div class="public anchor" id="var-catch"><h3>catch</h3><div class="usage"><code>(catch x error-handler)</code><code>(catch x error-class error-handler)</code></div><div class="doc"><div class="markdown"><p>An equivalent of the catch clause, which takes an <code>error-handler</code> function that will be invoked with the exception, and whose return value will be yielded as a successful outcome. If an <code>error-class</code> is specified, only exceptions of that type will be caught. If not, all exceptions will be caught.</p>
<pre><code>(-&gt; d
  (chain f g h)
  (catch IOException #(str &quot;oh no, IO: &quot; (.getMessage %)))
  (catch             #(str &quot;something unexpected: &quot; (.getMessage %))))
</code></pre></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L969">view source</a></div></div><div class="public anchor" id="var-catch.27"><h3>catch&apos;</h3><div class="usage"><code>(catch&apos; x error-handler)</code><code>(catch&apos; x error-class error-handler)</code></div><div class="doc"><div class="markdown"><p>Like <code>catch</code>, but does not coerce deferrable values.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L935">view source</a></div></div><div class="public anchor" id="var-chain"><h3>chain</h3><div class="usage"><code>(chain x)</code><code>(chain x f)</code><code>(chain x f g)</code><code>(chain x f g &amp; fs)</code></div><div class="doc"><div class="markdown"><p>Composes functions, left to right, over the value <code>x</code>, returning a deferred containing the result. When composing, either <code>x</code> or the returned values may be values which can be converted to a deferred, causing the composition to be paused.</p><p>The returned deferred will only be realized once all functions have been applied and their return values realized.</p>
<pre><code>@(chain 1 inc #(future (inc %))) =&gt; 3

@(chain (future 1) inc inc) =&gt; 3
</code></pre></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L909">view source</a></div></div><div class="public anchor" id="var-chain.27"><h3>chain&apos;</h3><div class="usage"><code>(chain&apos; x)</code><code>(chain&apos; x f)</code><code>(chain&apos; x f g)</code><code>(chain&apos; x f g &amp; fs)</code></div><div class="doc"><div class="markdown"><p>Like <code>chain</code>, but does not coerce deferrable values. This is useful both when coercion is undesired, or for 2-4x better performance than <code>chain</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L893">view source</a></div></div><div class="public anchor" id="var-claim.21"><h3>claim!</h3><div class="usage"><code>(claim! deferred)</code></div><div class="doc"><div class="markdown"><p>Attempts to claim the deferred for future updates. If successful, a claim token is returned, otherwise returns <code>nil</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L254">view source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><div class="usage"><code>(connect a b)</code></div><div class="doc"><div class="markdown"><p>Conveys the realized value of <code>a</code> into <code>b</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L624">view source</a></div></div><div class="public anchor" id="var-Deferrable"><h3>Deferrable</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L42">view source</a></div></div><div class="public anchor" id="var-deferrable.3F"><h3>deferrable?</h3><div class="usage"><code>(deferrable? x)</code></div><div class="doc"><div class="markdown"><p>Returns true if the object can be coerced to a Manifold deferred.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L95">view source</a></div></div><div class="public anchor" id="var-deferred"><h3>deferred</h3><div class="usage"><code>(deferred)</code><code>(deferred executor)</code></div><div class="doc"><div class="markdown"><p>Equivalent to Clojure&rsquo;s <code>promise</code>, but also allows asynchronous callbacks to be registered and composed via <code>chain</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L562">view source</a></div></div><div class="public anchor" id="var-deferred.3F"><h3>deferred?</h3><div class="usage"><code>(deferred? x)</code></div><div class="doc"><div class="markdown"><p>Returns true if the object is an instance of a Manifold deferred.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L87">view source</a></div></div><div class="public anchor" id="var-error.21"><h3>error!</h3><div class="usage"><code>(error! deferred x)</code><code>(error! deferred x claim-token)</code></div><div class="doc"><div class="markdown"><p>Puts the deferred into an error state.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L247">view source</a></div></div><div class="public anchor" id="var-error-deferred"><h3>error-deferred</h3><div class="usage"><code>(error-deferred error)</code><code>(error-deferred error executor)</code></div><div class="doc"><div class="markdown"><p>A deferred which already contains a realized error</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L598">view source</a></div></div><div class="public anchor" id="var-finally"><h3>finally</h3><div class="usage"><code>(finally x f)</code></div><div class="doc"><div class="markdown"><p>An equivalent of the finally clause, which takes a no-arg side-effecting function that executes no matter what the result.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1011">view source</a></div></div><div class="public anchor" id="var-finally.27"><h3>finally&apos;</h3><div class="usage"><code>(finally&apos; x f)</code></div><div class="doc"><div class="markdown"><p>Like <code>finally</code>, but doesn&rsquo;t coerce deferrable values.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L991">view source</a></div></div><div class="public anchor" id="var-future"><h3>future</h3><h4 class="type">macro</h4><div class="usage"><code>(future &amp; body)</code></div><div class="doc"><div class="markdown"><p>Equivalent to Clojure&rsquo;s <code>future</code>, but returns a Manifold deferred.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L661">view source</a></div></div><div class="public anchor" id="var-future-with"><h3>future-with</h3><h4 class="type">macro</h4><div class="usage"><code>(future-with executor &amp; body)</code></div><div class="doc"><div class="markdown"><p>Equivalent to Clojure&rsquo;s <code>future</code>, but allows specification of the executor and returns a Manifold deferred.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L649">view source</a></div></div><div class="public anchor" id="var-let-flow"><h3>let-flow</h3><h4 class="type">macro</h4><div class="usage"><code>(let-flow bindings &amp; body)</code></div><div class="doc"><div class="markdown"><p>A version of <code>let</code> where deferred values that are let-bound or closed over can be treated as if they are realized values. The body will only be executed once all of the let-bound values, even ones only used for side effects, have been computed.</p><p>Returns a deferred value, representing the value returned by the body.</p><p>(let-flow [x (future 1)]  (+ x 1))</p><p>(let-flow [x (future 1)  y (future (+ x 1))]  (+ y 1))</p><p>(let [x (future 1)]  (let-flow [y (future (+ x 1))]  (+ y 1)))</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1277">view source</a></div></div><div class="public anchor" id="var-let-flow.27"><h3>let-flow&apos;</h3><h4 class="type">macro</h4><div class="usage"><code>(let-flow&apos; bindings &amp; body)</code></div><div class="doc"><div class="markdown"><p>Like <code>let-flow</code>, but only for Manifold deferreds.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1301">view source</a></div></div><div class="public anchor" id="var-listener"><h3>listener</h3><div class="usage"><code>(listener on-success)</code><code>(listener on-success on-error)</code></div><div class="doc"><div class="markdown"><p>Creates a listener which can be registered or cancelled via <code>add-listener!</code> and <code>cancel-listener!</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L224">view source</a></div></div><div class="public anchor" id="var-loop"><h3>loop</h3><h4 class="type">macro</h4><div class="usage"><code>(loop bindings &amp; body)</code></div><div class="doc"><div class="markdown"><p>A version of Clojure&rsquo;s loop which allows for asynchronous loops, via <code>manifold.deferred/recur</code>. <code>loop</code> will always return a deferred value, even if the body is synchronous. Note that <code>loop</code> does <strong>not</strong> coerce values to deferreds, actual Manifold deferreds must be used.</p><p>(loop [i 1e6]  (chain (future i)  #(if (zero? %)  %  (recur (dec %)))))</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1126">view source</a></div></div><div class="public anchor" id="var-on-realized"><h3>on-realized</h3><div class="usage"><code>(on-realized x on-success on-error)</code></div><div class="doc"><div class="markdown"><p>Registers callbacks with the manifold deferred for both success and error outcomes.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L80">view source</a></div></div><div class="public anchor" id="var-onto"><h3>onto</h3><div class="usage"><code>(onto d executor)</code></div><div class="doc"><div class="markdown"><p>Returns a deferred whose callbacks will be run on <code>executor</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L642">view source</a></div></div><div class="public anchor" id="var-realized.3F"><h3>realized?</h3><div class="usage"><code>(realized? x)</code></div><div class="doc"><div class="markdown"><p>Returns true if the manifold deferred is realized.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L53">view source</a></div></div><div class="public anchor" id="var-recur"><h3>recur</h3><div class="usage"><code>(recur &amp; args)</code></div><div class="doc"><div class="markdown"><p>A special recur that can be used with <code>manifold.deferred/loop</code>.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1121">view source</a></div></div><div class="public anchor" id="var-success.21"><h3>success!</h3><div class="usage"><code>(success! deferred x)</code><code>(success! deferred x claim-token)</code></div><div class="doc"><div class="markdown"><p>Equivalent to <code>deliver</code>, but allows a <code>claim-token</code> to be passed in.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L240">view source</a></div></div><div class="public anchor" id="var-success-deferred"><h3>success-deferred</h3><div class="usage"><code>(success-deferred val)</code><code>(success-deferred val executor)</code></div><div class="doc"><div class="markdown"><p>A deferred which already contains a realized value</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L577">view source</a></div></div><div class="public anchor" id="var-timeout.21"><h3>timeout!</h3><div class="usage"><code>(timeout! d interval)</code><code>(timeout! d interval timeout-value)</code></div><div class="doc"><div class="markdown"><p>Takes a deferred, and sets a timeout on it, such that it will be realized as <code>timeout-value</code> (or a TimeoutException if none is specified) if it is not realized in <code>interval</code> ms. Returns the deferred that was passed in.</p><p>This will act directly on the deferred value passed in. If the deferred represents a value returned by <code>chain</code>, all actions not yet completed will be short-circuited upon timeout.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1082">view source</a></div></div><div class="public anchor" id="var-unwrap"><h3>unwrap</h3><div class="usage"><code>(unwrap x)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L615">view source</a></div></div><div class="public anchor" id="var-unwrap.27"><h3>unwrap&apos;</h3><div class="usage"><code>(unwrap&apos; x)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L607">view source</a></div></div><div class="public anchor" id="var-zip"><h3>zip</h3><div class="usage"><code>(zip &amp; vals)</code></div><div class="doc"><div class="markdown"><p>Takes a list of values, some of which may be deferrable, and returns a deferred that will yield a list of realized values.</p>
<pre><code> @(zip 1 2 3) =&gt; [1 2 3]
 @(zip (future 1) 2 3) =&gt; [1 2 3]
</code></pre></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1067">view source</a></div></div><div class="public anchor" id="var-zip.27"><h3>zip&apos;</h3><div class="usage"><code>(zip&apos; &amp; vals)</code></div><div class="doc"><div class="markdown"><p>Like <code>zip</code>, but only unwraps Manifold deferreds.</p></div></div><div class="src-link"><a href="https://github.com/ztellman/manifold/blob/master/src/manifold/deferred.clj#L1019">view source</a></div></div></div></body></html>